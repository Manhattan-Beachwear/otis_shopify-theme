{%- comment -%}
  Intended for blocks and sections that provide values for all the referenced settings.

  <div class="spacing-style" style="{%  render 'spacing-style', settings: section.settings %}">

   Accepts:
      settings: {settings || section.settings}
{%- endcomment -%}

{% assign preset = preset | default: settings.type_preset %}

{%- capture variables -%}
  {%- if settings.custom_color != blank -%}
    --color: {{ settings.custom_color }};
  {%- elsif settings.color != "" -%}
    --color: {{ settings.color }};
  {%- endif -%}
  {%- if settings.font_style != blank and settings.font_style != 'normal' -%}
    {%- if settings.font_style == 'bold' or settings.font_style == 'bold italic' -%}
      --font-weight: 700;
    {%- endif -%}
    {%- if settings.font_style == 'italic' or settings.font_style == 'bold italic' -%}
      --font-style: italic;
    {%- endif -%}
  {%- endif -%}
  {%- if settings.font_size != blank -%}
    {% liquid
      unless type
        comment
          When choosing to customize the font, picking a specific font size
          determines the type of text block.
        endcomment
        if settings.font_size != ''
          assign font_size_value = settings.font_size | split: 'rem' | first | times: 1.0

          if font_size_value > 4.5
            assign type = 'display'
          elsif font_size_value > 3.5
            assign type = 'heading'
          else
            assign type = 'body'
          endif
        endif
      endunless
    %}
{%- liquid
  assign font_size_rem = settings.font_size | split: 'rem' | first | times: 1.0
      assign fluid_size_cutoff_rem = 3.0

      if font_size_rem >= fluid_size_cutoff_rem
        assign target_viewport = 1400
        assign vw_value = font_size_rem | times: 16 | divided_by: target_viewport | times: 100

        assign scale_factor = font_size_rem | divided_by: fluid_size_cutoff_rem
        assign base_min_rem = 3.0
        assign scaling_bonus_rem = scale_factor | minus: 1 | times: 0.25
        assign dynamic_min_rem = base_min_rem | plus: scaling_bonus_rem
      endif
    -%}
    {%- if font_size_rem >= fluid_size_cutoff_rem -%}
      --font-size: clamp({{ dynamic_min_rem }}rem, {{ vw_value }}vw, {{ settings.font_size }});
    {%- else -%}
      --font-size: {{ settings.font_size }};
    {%- endif -%}
  {%- endif -%}
  {%- if preset == 'custom' -%}
    {%- if settings.font_style == blank or settings.font_style == 'normal' -%}
      {%- if settings.weight != blank -%}
        --font-weight: {{ settings.weight }};
      {%- else -%}
        {%- liquid
          comment
            When using body font with custom preset and no explicit weight,
            use the paragraph weight from theme settings instead of generic body weight
          endcomment
          if settings.font == 'var(--font-body--family)' and type == 'body'
            assign use_paragraph_weight = true
          else
            assign use_paragraph_weight = false
          endif
        -%}
        {%- if use_paragraph_weight -%}
          --font-weight: var(--font-paragraph--weight);
        {%- else -%}
          --font-weight: {{ settings.font | replace: 'family', 'weight' }};
        {%- endif -%}
      {%- endif -%}
    {%- endif -%}
    --font-family: {{ settings.font }};
    --text-transform: {{ settings.case }};
    --text-wrap: {{ settings.wrap }};
    {% if settings.type_preset == 'custom' and settings.font_size == blank %}
      --line-height--display: var(--line-height--display-{{ settings.line_height }});
      --line-height--heading: var(--line-height--heading-{{ settings.line_height }});
      --line-height--body: var(--line-height--body-{{ settings.line_height }});
    {% else %}
      --line-height: var(--line-height--{{ type }}-{{ settings.line_height }});
    {% endif %}
    {%- liquid
      comment
        When using body font with custom preset, use the paragraph letter spacing
        from theme settings instead of generic body letter spacing variables
      endcomment
      if settings.font == 'var(--font-body--family)' and type == 'body' and settings.letter_spacing == 'normal'
        assign use_paragraph_letter_spacing = true
      else
        assign use_paragraph_letter_spacing = false
      endif
    -%}
    {%- if use_paragraph_letter_spacing -%}
      --letter-spacing: var(--font-paragraph--letter-spacing);
    {%- else -%}
      --letter-spacing: var(--letter-spacing--{{ type }}-{{ settings.letter_spacing }});
    {%- endif -%}
  {%- endif -%}
{%- endcapture -%}
{{- variables | strip | strip_newlines -}}
