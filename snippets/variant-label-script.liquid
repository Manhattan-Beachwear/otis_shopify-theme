{% comment %}
  Variant Label Update Script
{% endcomment %}

{% javascript %}
(function() {
  function updateVariantLabel(productId, variantName, container) {
    if (!variantName) return;
    
    console.log('[Variant Label] Updating for product', productId, 'to:', variantName);
    
    const labels = document.querySelectorAll(`[data-variant-label][data-product-id="${productId}"]`);
    
    labels.forEach(label => {
      label.textContent = variantName;
      
      if (variantName.trim() === '') {
        label.classList.add('variant-label--empty');
      } else {
        label.classList.remove('variant-label--empty');
      }
    });
    
    if (container) {
      const legacyLabels = container.querySelectorAll('.variant-option__current-variant-name');
      legacyLabels.forEach(label => {
        label.textContent = variantName;
      });
      
      const swatchValueSpans = container.querySelectorAll('.variant-option__swatch-value, .variant-picker-cl-dual__swatch-value');
      swatchValueSpans.forEach(span => {
        span.textContent = variantName;
      });
    }
  }

  function getVariantNameFromElement(element) {
    if (element.dataset && element.dataset.variantName) {
      return element.dataset.variantName;
    }
    
    const input = element.querySelector('input[type="radio"]');
    if (input && input.dataset && input.dataset.variantName) {
      return input.dataset.variantName;
    }
    
    if (element.getAttribute) {
      const ariaLabel = element.getAttribute('aria-label');
      if (ariaLabel) return ariaLabel;
    }
    
    if (input) {
      const inputAriaLabel = input.getAttribute('aria-label');
      if (inputAriaLabel) return inputAriaLabel;
    }
    
    if (element.value) {
      return element.value;
    }
    
    if (input && input.value) {
      return input.value;
    }
    
    return null;
  }

  function setupVariantLabelListeners(container, productId) {
    if (!container || !productId) return;
    
    const swatches = container.querySelectorAll('label');
    const selects = container.querySelectorAll('select');
    
    swatches.forEach(swatch => {
      swatch.addEventListener('mouseenter', (e) => {
        const variantName = getVariantNameFromElement(e.currentTarget);
        if (variantName) {
          updateVariantLabel(productId, variantName, container);
        }
      });
      
      const input = swatch.querySelector('input[type="radio"]');
      if (input) {
        input.addEventListener('change', (e) => {
          if (e.target.checked) {
            const variantName = getVariantNameFromElement(e.target);
            if (variantName) {
              updateVariantLabel(productId, variantName, container);
            }
          }
        });
      }
    });
    
    selects.forEach(select => {
      select.addEventListener('change', (e) => {
        const selectedOption = e.target.options[e.target.selectedIndex];
        if (selectedOption && selectedOption.dataset.variantName) {
          updateVariantLabel(productId, selectedOption.dataset.variantName, container);
        }
      });
      
      select.addEventListener('mouseover', (e) => {
        if (e.target.tagName === 'OPTION' && e.target.dataset.variantName) {
          updateVariantLabel(productId, e.target.dataset.variantName, container);
        }
      });
    });
    
    container.addEventListener('mouseleave', () => {
      const selectedInput = container.querySelector('input[type="radio"]:checked');
      if (selectedInput) {
        const variantName = getVariantNameFromElement(selectedInput);
        if (variantName) {
          updateVariantLabel(productId, variantName, container);
        }
      }
      
      const selectedSelects = container.querySelectorAll('select');
      selectedSelects.forEach(select => {
        const selectedOption = select.options[select.selectedIndex];
        if (selectedOption && selectedOption.dataset.variantName) {
          updateVariantLabel(productId, selectedOption.dataset.variantName, container);
        }
      });
    });
  }

  function initializeAllVariantLabels() {
    const variantPickers = document.querySelectorAll('[data-product-id][data-section-id]');
    
    variantPickers.forEach(picker => {
      const productId = picker.dataset.productId;
      if (productId) {
        setupVariantLabelListeners(picker, productId);
      }
    });
    
    const swatchPickers = document.querySelectorAll('swatches-variant-picker-component[data-product-id]');
    swatchPickers.forEach(picker => {
      const productId = picker.dataset.productId;
      if (productId) {
        setupVariantLabelListeners(picker, productId);
      }
    });
    
    const dualPickers = document.querySelectorAll('variant-picker-cl-dual[data-product-id]');
    dualPickers.forEach(picker => {
      const productId = picker.dataset.productId;
      if (productId) {
        setupVariantLabelListeners(picker, productId);
      }
    });
    
    const productSwatches = document.querySelectorAll('product-swatches[data-product-id]');
    productSwatches.forEach(swatch => {
      const productId = swatch.dataset.productId;
      if (productId) {
        setupVariantLabelListeners(swatch, productId);
      }
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeAllVariantLabels);
  } else {
    initializeAllVariantLabels();
  }
})();
{% endjavascript %}
