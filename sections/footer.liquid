<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div
  class="section section--{{ section.settings.section_width }} color-{{ section.settings.color_scheme }}"
>
  {% liquid
    assign total_blocks = section.blocks.size

    # Grid layout calculations
    assign grid_columns = total_blocks | at_most: 4

    # Calculate last row counts using modulo arithmetic
    # last_row_count = (total_blocks - 1) % N + 1
    assign last_row_count = total_blocks | minus: 1 | modulo: 4 | plus: 1
    assign tablet_last_row_count = total_blocks | minus: 1 | modulo: 3 | plus: 1

    # Check if there are orphaned elements (single item in last row)
    assign has_isolated_grid_item_desktop = false
    assign has_isolated_grid_item_tablet = false

    if total_blocks > 4 and last_row_count == 1
      assign has_isolated_grid_item_desktop = true
    endif

    if total_blocks > 3 and tablet_last_row_count == 1
      assign has_isolated_grid_item_tablet = true
    endif

    # Alignment calculations (similar to layout-panel-style)
    assign content_direction = section.settings.content_direction | default: 'column'
    
    if content_direction == 'row'
      assign horizontal_alignment = section.settings.horizontal_alignment | default: 'flex-start'
      assign vertical_alignment = section.settings.vertical_alignment | default: 'flex-start'
    else
      assign horizontal_alignment = section.settings.horizontal_alignment_flex_direction_column | default: 'flex-start'
      assign vertical_alignment = section.settings.vertical_alignment_flex_direction_column | default: 'flex-start'
    endif

    # Map flexbox values to grid values
    assign grid_justify_items = horizontal_alignment
    if horizontal_alignment == 'flex-start'
      assign grid_justify_items = 'start'
    elsif horizontal_alignment == 'flex-end'
      assign grid_justify_items = 'end'
    elsif horizontal_alignment == 'space-between'
      assign grid_justify_items = 'stretch'
    endif

    assign grid_align_items = vertical_alignment
    if vertical_alignment == 'flex-start'
      assign grid_align_items = 'start'
    elsif vertical_alignment == 'flex-end'
      assign grid_align_items = 'end'
    endif
  %}
  <div
    class="
      footer-content
      spacing-style
      {% if has_isolated_grid_item_desktop %}footer-content--isolated-grid-item-desktop{% endif %}
      {% if has_isolated_grid_item_tablet %}footer-content--isolated-grid-item-tablet{% endif %}
      {% if content_direction == 'row' %}footer-content--direction-row{% endif %}
      {% if content_direction == 'column' %}footer-content--direction-column{% endif %}
      {% if section.settings.vertical_on_mobile and content_direction == 'row' %}footer-content--vertical-on-mobile{% endif %}
      {% if content_direction != 'row' and vertical_alignment == 'space-between' %}footer-content--space-between{% endif %}
    "
    style="
      {%  render 'spacing-style', settings: section.settings %}
      --footer-gap: {{ section.settings.gap }}px;
      --grid-columns: {{ grid_columns }};
      --last-row-count: {{ last_row_count }};
      --tablet-last-row-count: {{ tablet_last_row_count }};
      --content-direction: {{ content_direction }};
      --horizontal-alignment: {{ horizontal_alignment | default: 'flex-start' }};
      --vertical-alignment: {{ vertical_alignment | default: 'flex-start' }};
      --grid-justify-items: {{ grid_justify_items | default: 'start' }};
      --grid-align-items: {{ grid_align_items | default: 'start' }};
    "
  >
    {% content_for 'blocks' %}
  </div>
</div>

{% stylesheet %}
  /* Mobile: Single column layout (base styles) */
  .footer-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--footer-gap);
    justify-items: var(--grid-justify-items, start);
    align-items: var(--grid-align-items, start);
  }

  /* Column direction - use flexbox for vertical stacking */
  .footer-content--direction-column {
    display: flex;
    flex-direction: column;
    gap: var(--footer-gap);
    justify-content: var(--vertical-alignment, flex-start);
    align-items: var(--horizontal-alignment, flex-start);
  }

  /* When vertical alignment is space-between in column direction */
  .footer-content--space-between {
    justify-content: space-between;
  }

  /* Vertical on mobile when direction is row */
  .footer-content--vertical-on-mobile {
    grid-template-columns: 1fr;
  }

  /* Row direction - switch to flexbox for better control */
  .footer-content--direction-row {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: var(--footer-gap);
    justify-content: var(--horizontal-alignment, flex-start);
    align-items: var(--vertical-alignment, flex-start);
  }

  .footer-content--direction-row > * {
    flex: 0 1 auto;
  }

  @media screen and (min-width: 750px) and (max-width: 989px) {
    /* Grid layout only when not using direction settings */
    .footer-content:not(.footer-content--direction-row):not(.footer-content--direction-column):not(.footer-content--space-between) {
      grid-template-columns: repeat(min(var(--grid-columns), 3), 1fr);
      grid-auto-flow: row;
    }
    
    .footer-content--isolated-grid-item-tablet > :last-child {
      grid-column: 1 / -1;
    }

    .footer-content--vertical-on-mobile.footer-content--direction-row {
      flex-direction: column;
    }
  }

  @media screen and (min-width: 990px) {
    /* Grid layout only when not using direction settings */
    .footer-content:not(.footer-content--direction-row):not(.footer-content--direction-column):not(.footer-content--space-between) {
      grid-template-columns: repeat(var(--grid-columns), 1fr);
    }

    /* Single item centered */
    .footer-content:not(.footer-content--direction-row):not(.footer-content--direction-column):not(.footer-content--space-between)[style*='--grid-columns: 1'] {
      justify-items: center;
    }

    .footer-content--isolated-grid-item-desktop > :last-child {
      grid-column: 1 / -1;
    }

    .footer-content--vertical-on-mobile.footer-content--direction-row {
      flex-direction: row;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.footer",
  "class": "section-wrapper",
  "tag": "footer",
  "blocks": [
    {
      "type": "_divider"
    },
    {
      "type": "@app"
    },
    {
      "type": "button"
    },
    {
      "type": "follow-on-shop"
    },
    {
      "type": "group"
    },
    {
      "type": "icon"
    },
    {
      "type": "image"
    },
    {
      "type": "menu"
    },
    {
      "type": "payment-icons"
    },
    {
      "type": "text"
    },
    {
      "type": "logo"
    },
    {
      "type": "jumbo-text"
    },
    {
      "type": "social-links"
    },
    {
      "type": "email-signup"
    }
  ],
  "enabled_on": {
    "groups": ["footer"]
  },
  "settings": [
    {
      "type": "select",
      "id": "section_width",
      "label": "t:settings.width",
      "options": [
        {
          "value": "page-width",
          "label": "t:options.page"
        },
        {
          "value": "full-width",
          "label": "t:options.full"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "header",
      "content": "t:content.layout"
    },
    {
      "type": "select",
      "id": "content_direction",
      "label": "t:settings.direction",
      "options": [
        {
          "value": "column",
          "label": "t:options.vertical"
        },
        {
          "value": "row",
          "label": "t:options.horizontal"
        }
      ],
      "default": "column"
    },
    {
      "type": "checkbox",
      "id": "vertical_on_mobile",
      "label": "t:settings.vertical_on_mobile",
      "default": true,
      "visible_if": "{{ section.settings.content_direction == 'row' }}"
    },
    {
      "type": "select",
      "id": "horizontal_alignment",
      "label": "t:settings.alignment",
      "options": [
        {
          "value": "flex-start",
          "label": "t:options.left"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "flex-end",
          "label": "t:options.right"
        },
        {
          "value": "space-between",
          "label": "t:options.space_between"
        }
      ],
      "default": "flex-start",
      "visible_if": "{{ section.settings.content_direction == 'row' }}"
    },
    {
      "type": "select",
      "id": "vertical_alignment",
      "label": "t:settings.position",
      "options": [
        {
          "value": "flex-start",
          "label": "t:options.top"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "flex-end",
          "label": "t:options.bottom"
        }
      ],
      "default": "flex-start",
      "visible_if": "{{ section.settings.content_direction == 'row' }}"
    },
    {
      "type": "select",
      "id": "horizontal_alignment_flex_direction_column",
      "label": "t:settings.alignment",
      "options": [
        {
          "value": "flex-start",
          "label": "t:options.left"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "flex-end",
          "label": "t:options.right"
        }
      ],
      "default": "flex-start",
      "visible_if": "{{ section.settings.content_direction != 'row' }}"
    },
    {
      "type": "select",
      "id": "vertical_alignment_flex_direction_column",
      "label": "t:settings.position",
      "options": [
        {
          "value": "flex-start",
          "label": "t:options.top"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "flex-end",
          "label": "t:options.bottom"
        },
        {
          "value": "space-between",
          "label": "t:options.space_between"
        }
      ],
      "default": "flex-start",
      "visible_if": "{{ section.settings.content_direction == 'column' }}"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "t:settings.gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 20
    }
  ],
  "presets": [
    {
      "name": "t:names.footer",
      "category": "t:categories.footer",
      "settings": {
        "gap": 20,
        "color_scheme": "scheme-1",
        "padding-block-start": 36,
        "padding-block-end": 36
      },
      "blocks": {
        "newsletter-group": {
          "type": "group",
          "settings": {
            "content_direction": "column",
            "vertical_on_mobile": true,
            "horizontal_alignment": "flex-start",
            "vertical_alignment": "center",
            "gap": 6,
            "width": "fill",
            "inherit_color_scheme": true
          },
          "blocks": {
            "newsletter-heading": {
              "type": "text",
              "settings": {
                "text": "t:html_defaults.join_our_email_list",
                "width": "100%",
                "alignment": "left",
                "type_preset": "h3"
              }
            },
            "newsletter-text": {
              "type": "text",
              "settings": {
                "text": "t:html_defaults.get_exclusive_deals_and_early_access_to_new_products",
                "width": "100%",
                "alignment": "left",
                "type_preset": "rte"
              }
            }
          },
          "block_order": ["newsletter-heading", "newsletter-text"]
        },
        "newsletter-form": {
          "type": "email-signup",
          "settings": {
            "width": "fill"
          }
        }
      },
      "block_order": ["newsletter-group", "newsletter-form"]
    }
  ]
}
{% endschema %}
